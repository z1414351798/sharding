1ï¸âƒ£ ä¸‹è½½å’Œå®‰è£… Redis 6
brew install redis@6


ç¡®è®¤å®‰è£…ï¼š

redis-server -v
# Redis server v=6.x.x ...

2ï¸âƒ£ åˆ›å»º Redis é…ç½®æ–‡ä»¶å’Œæ•°æ®ç›®å½•

å‡è®¾ä½ åœ¨ ~/redis-cluster ä¸‹æ“ä½œï¼š

mkdir -p ~/redis-cluster/{7000,7001,7002,7003,7004,7005}


ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ 7000/redis.confï¼š

port 7001
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes-7001.conf
cluster-node-timeout 5000
appendonly yes
appendfilename "appendonly-7001.aof"
dir ./
dbfilename dump-7001.rdb
save 900 1
save 300 10
save 60 10000
protected-mode no
logfile "redis-7001.log"


ä¾æ¬¡åˆ›å»º 7000-7005 çš„é…ç½®æ–‡ä»¶ï¼Œåªä¿®æ”¹ï¼š

port

cluster-config-file

appendfilename

dbfilename

logfile

3ï¸âƒ£ å¯åŠ¨ Redis å®ä¾‹

æ‰“å¼€ 6 ä¸ªç»ˆç«¯æˆ–è€…ç”¨ & åå°å¯åŠ¨ï¼š

redis-server ~/redis-cluster/7001/redis.conf
redis-server ~/redis-cluster/7002/redis.conf
redis-server ~/redis-cluster/7003/redis.conf
redis-server ~/redis-cluster/7004/redis.conf
redis-server ~/redis-cluster/7005/redis.conf
redis-server ~/redis-cluster/7006/redis.conf

4ï¸âƒ£ åˆ›å»º Redis Cluster

ç”¨ redis-cli --cluster create è¿æ¥ 6 ä¸ªèŠ‚ç‚¹ï¼š

redis-cli --cluster create \
127.0.0.1:7001 \
127.0.0.1:7002 \
127.0.0.1:7003 \
127.0.0.1:7004 \
127.0.0.1:7005 \
127.0.0.1:7006 \
--cluster-replicas 1


è¾“å‡ºä¼šè¦æ±‚ç¡®è®¤ yesï¼Œå®Œæˆåä½ å°±æœ‰ 3 ä¸» 3 ä»çš„ clusterã€‚

5ï¸âƒ£ æ£€æŸ¥ cluster çŠ¶æ€
redis-cli -p 7001 cluster info
redis-cli -p 7001 cluster nodes


ğŸ”» æ­¥éª¤ 1ï¼šä¼˜é›…å…³é—­æ‰€æœ‰èŠ‚ç‚¹

è¿›å…¥æ¯ä¸ªèŠ‚ç‚¹ç›®å½•ï¼Œæ‰§è¡Œ shutdownï¼š

redis-cli -p 7001 shutdown
redis-cli -p 7002 shutdown
redis-cli -p 7003 shutdown
redis-cli -p 7004 shutdown
redis-cli -p 7005 shutdown
redis-cli -p 7006 shutdown


å¦‚æœæŸäº›èŠ‚ç‚¹å…³é—­å¡ä½æˆ–æŠ¥é”™ï¼ˆå¸¸è§ï¼‰ï¼Œæ‰§è¡Œå¼ºåˆ¶ killï¼š

ps aux | grep redis
kill -9 <pid>

ğŸ”º æ­¥éª¤ 2ï¼šé‡æ–°å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåå°å¯åŠ¨ï¼‰
redis-server ~/redis-cluster/7001/redis.conf &
redis-server ~/redis-cluster/7002/redis.conf &
redis-server ~/redis-cluster/7003/redis.conf &
redis-server ~/redis-cluster/7004/redis.conf &
redis-server ~/redis-cluster/7005/redis.conf &
redis-server ~/redis-cluster/7006/redis.conf &


ä¸‹é¢ç»™ä½ ä¸€ä¸ª æœ€å…¨ã€æœ€å®ç”¨ã€é¢è¯• & å·¥ä½œéƒ½å¸¸ç”¨çš„ Redis å‘½ä»¤é€ŸæŸ¥è¡¨ã€‚
åˆ†é—¨åˆ«ç±»ï¼Œå…¨éƒ¨æ˜¯æ—¥å¸¸å¼€å‘é‡Œæœ€å¸¸ç”¨çš„è¯­æ³•ã€‚

ğŸŸ¥ ä¸€ã€Redis è¿æ¥ä¸åŸºæœ¬æ“ä½œ
â–¶ è¿æ¥ Redis
redis-cli -p 7001

â–¶ PING æ£€æŸ¥æœåŠ¡
PING

â–¶ æŸ¥çœ‹æ‰€æœ‰ key
KEYS *

â–¶ æ¨¡ç³ŠåŒ¹é… key
KEYS user:*

â–¶ åˆ é™¤ key
DEL key

â–¶ è®¾ç½®è¿‡æœŸæ—¶é—´
EXPIRE key 60
TTL key

ğŸŸ¦ äºŒã€String ç±»å‹ï¼ˆæœ€å¸¸ç”¨ï¼‰
è®¾ç½®å€¼
SET name andy

è·å–å€¼
GET name

è‡ªå¢/è‡ªå‡
INCR counter
DECR counter
INCRBY counter 10

è®¾ç½®è¿‡æœŸå€¼
SET code 123 EX 60

åªæœ‰ä¸å­˜åœ¨æ—¶æ‰å†™ï¼ˆåˆ†å¸ƒå¼é”å¸¸ç”¨ï¼‰
SETNX lock_key value

ğŸŸ¨ ä¸‰ã€Hashï¼ˆå¯¹è±¡ç»“æ„ï¼‰

é€‚åˆä¿å­˜ç”¨æˆ·ã€å•†å“ç­‰å¯¹è±¡ã€‚

è®¾ç½® Hash å­—æ®µ
HSET user:1 name "Andy" age 30

è·å–ä¸€ä¸ªå­—æ®µ
HGET user:1 name

è·å–æ‰€æœ‰å­—æ®µ
HGETALL user:1

åˆ é™¤æŸä¸ªå­—æ®µ
HDEL user:1 age

åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨
HEXISTS user:1 name

ğŸŸ© å››ã€Listï¼ˆé˜Ÿåˆ—å¸¸ç”¨ï¼‰
ä»å³è¾¹ push
RPUSH queue 1 2 3

ä»å·¦è¾¹ push
LPUSH queue a b c

ä»å·¦ pop
LPOP queue

è¯»å–èŒƒå›´
LRANGE queue 0 -1

é˜»å¡å¼ popï¼ˆæ¶ˆæ¯é˜Ÿåˆ—å¸¸ç”¨ï¼‰
BLPOP queue 5

ğŸŸ§ äº”ã€Setï¼ˆå»é‡é›†åˆï¼‰
æ·»åŠ å…ƒç´ 
SADD tags java python go

æŸ¥çœ‹æ‰€æœ‰å…ƒç´ 
SMEMBERS tags

æ˜¯å¦å­˜åœ¨
SISMEMBER tags java

ä¸¤ä¸ªé›†åˆæ±‚äº¤é›†
SINTER s1 s2

ğŸŸª å…­ã€ZSetï¼ˆæ’åºé›†åˆï¼šæ’è¡Œæ¦œæœ€å¸¸ç”¨ï¼‰
æ·»åŠ å…ƒç´ ä¸åˆ†æ•°
ZADD rank 100 andy

è·å–æ’ååŒºé—´
ZRANGE rank 0 10 WITHSCORES

è·å–å€’åºï¼ˆåˆ†æ•°ä»å¤§åˆ°å°ï¼‰
ZREVRANGE rank 0 10 WITHSCORES

è·å–å•ä¸ªåˆ†æ•°
ZSCORE rank andy

è‡ªå¢åˆ†æ•°
ZINCRBY rank 10 andy

ğŸŸ« ä¸ƒã€Key ç®¡ç†
æŸ¥çœ‹ç±»å‹
TYPE key

key æ˜¯å¦å­˜åœ¨
EXISTS key

æ”¹å
RENAME old new

åˆ é™¤å¤šä¸ª key
DEL k1 k2 k3

âš« å…«ã€äº‹åŠ¡ï¼ˆTransactionï¼‰
å¼€å¯äº‹åŠ¡
MULTI

æäº¤
EXEC

å–æ¶ˆ
DISCARD

âšª ä¹ã€å‘å¸ƒè®¢é˜…ï¼ˆPub/Subï¼‰
è®¢é˜…
SUBSCRIBE news

å‘å¸ƒ
PUBLISH news "hello"

ğŸ”µ åã€Cluster å¸¸ç”¨å‘½ä»¤
æŸ¥çœ‹ cluster ä¿¡æ¯
cluster info

æŸ¥çœ‹èŠ‚ç‚¹
cluster nodes

è¿ç§» slotï¼ˆè¿ç»´ç”¨ï¼‰
redis-cli --cluster reshard 127.0.0.1:7001

é›†ç¾¤é”®å­˜å‚¨æ£€æŸ¥
CLUSTER KEYSLOT user:1

ğŸ”¥ åä¸€ã€Redis æ€§èƒ½è°ƒè¯•
æ…¢æŸ¥è¯¢
SLOWLOG GET

å†…å­˜ä½¿ç”¨æƒ…å†µ
INFO memory

æŸ¥çœ‹ CPU / è¿æ¥æ•° / key æ•°é‡
INFO

ğŸ åäºŒã€å®é™…é¡¹ç›®å¸¸ç”¨å†™æ³•ï¼ˆæœ€æœ‰ä»·å€¼ï¼‰
è·å–åˆ†å¸ƒå¼é”
SET lock_key uuid EX 10 NX

åˆ é™¤é”ï¼ˆä¿æŒåŸå­æ€§ï¼‰
eval "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end" 1 lock_key uuid

é™æµï¼ˆæ»‘åŠ¨çª—å£ï¼‰
ZADD reqs timestamp member
ZREMRANGEBYSCORE reqs 0 timestamp-1000
ZCARD reqs